<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zhalecth - Resi Pengiriman</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --primary: #1a1a1a;
            --secondary: #333333;
            --accent: #666666;
            --light: #f5f5f5;
            --white: #ffffff;
            --transition: all 0.3s ease;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --success: #28a745;
            --warning: #ffc107;
            --info: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--primary);
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .logo span {
            color: var(--accent);
        }

        .back-link {
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .back-link:hover {
            color: var(--accent);
        }

        /* Main Content */
        main {
            padding: 40px 0;
            min-height: 80vh;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: var(--secondary);
            margin-bottom: 20px;
        }

        /* Search Section */
        .search-section {
            max-width: 600px;
            margin: 0 auto 40px;
        }

        .search-box {
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-btn {
            padding: 12px 25px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-btn:hover {
            background: var(--accent);
        }

        /* Receipt Card */
        .receipt-card {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            overflow: hidden;
            transition: var(--transition);
        }

        .receipt-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .receipt-header {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: var(--white);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .receipt-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .receipt-number {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 20px;
            letter-spacing: 1px;
        }

        .receipt-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-created { background: var(--info); }
        .status-received { background: var(--info); }
        .status-transit { background: var(--warning); }
        .status-delivery { background: var(--info); }
        .status-delivered { background: var(--success); }
        .status-failed { background: #dc3545; }

        .receipt-body {
            padding: 25px;
        }

        .receipt-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .info-section h4 {
            margin-bottom: 15px;
            color: var(--accent);
            border-bottom: 2px solid var(--light);
            padding-bottom: 8px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light);
        }

        .info-label {
            font-weight: 600;
            color: var(--secondary);
        }

        .info-value {
            text-align: right;
        }

        /* Tracking Timeline */
        .tracking-timeline {
            margin-top: 25px;
        }

        .timeline-title {
            margin-bottom: 20px;
            color: var(--accent);
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--light);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light);
        }

        .timeline-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent);
            border: 3px solid var(--white);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .timeline-item.active::before {
            background: var(--success);
            box-shadow: 0 0 0 2px var(--success);
        }

        .timeline-content h5 {
            margin-bottom: 5px;
            font-size: 16px;
        }

        .timeline-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--accent);
        }

        /* Receipt Actions */
        .receipt-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            font-size: 14px;
        }

        .btn:hover {
            background-color: var(--accent);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #218838;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--accent);
        }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 20px;
            color: var(--light);
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .receipt-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .receipt-grid {
                grid-template-columns: 1fr;
            }

            .search-box {
                flex-direction: column;
            }

            .receipt-actions {
                flex-direction: column;
            }

            .btn {
                justify-content: center;
            }

            .timeline-meta {
                flex-direction: column;
                gap: 5px;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 24px;
            }

            .receipt-number {
                font-size: 16px;
            }

            .receipt-body {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="azhalecth.html" class="logo">ZHALE<span>CTH</span></a>
                <a href="orders.html" class="back-link">
                    <i class="fas fa-arrow-left"></i>
                    Kembali ke Pesanan
                </a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="page-header">
                <h1 class="page-title">Lacak Resi Pengiriman</h1>
                <p class="page-subtitle">Pantau status pengiriman pesanan Anda</p>
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <div class="search-box">
                    <input type="text" class="search-input" id="search-input" 
                           placeholder="Masukkan nomor resi atau ID pesanan...">
                    <button class="search-btn" id="search-btn">
                        <i class="fas fa-search"></i> Cari
                    </button>
                </div>
            </div>

            <!-- Receipts Container -->
            <div id="receipts-container">
                <!-- Receipts will be populated by JavaScript -->
            </div>
        </div>
    </main>

    <script src="receipt-system.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const receiptsContainer = document.getElementById('receipts-container');
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');

            // Check if specific receipt is requested via URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const receiptParam = urlParams.get('receipt');
            
            if (receiptParam) {
                searchInput.value = receiptParam;
                searchReceipts();
            } else {
                // Load all receipts on page load
                loadAllReceipts();
            }

            // Search functionality
            searchBtn.addEventListener('click', searchReceipts);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchReceipts();
                }
            });

            function loadAllReceipts() {
                const receipts = receiptSystem.getAllReceipts();
                displayReceipts(receipts);
            }

            function searchReceipts() {
                const query = searchInput.value.trim().toLowerCase();
                
                if (!query) {
                    loadAllReceipts();
                    return;
                }

                const receipts = receiptSystem.getAllReceipts();
                const filteredReceipts = receipts.filter(receipt => 
                    receipt.receiptNumber.toLowerCase().includes(query) ||
                    receipt.orderId.toLowerCase().includes(query) ||
                    receipt.receiver.name.toLowerCase().includes(query)
                );

                displayReceipts(filteredReceipts);
            }

            function displayReceipts(receipts) {
                receiptsContainer.innerHTML = '';

                if (receipts.length === 0) {
                    receiptsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <h3>Tidak ada resi ditemukan</h3>
                            <p>Belum ada resi pengiriman atau pencarian tidak ditemukan.</p>
                            <a href="orders.html" class="btn" style="margin-top: 20px;">
                                <i class="fas fa-shopping-bag"></i> Lihat Pesanan Saya
                            </a>
                        </div>
                    `;
                    return;
                }

                // Sort receipts by date (newest first)
                receipts.sort((a, b) => new Date(b.generatedAt) - new Date(a.generatedAt));

                receipts.forEach(receipt => {
                    const receiptElement = createReceiptElement(receipt);
                    receiptsContainer.appendChild(receiptElement);
                });
            }

            function createReceiptElement(receipt) {
                const receiptCard = document.createElement('div');
                receiptCard.className = 'receipt-card';

                // Format dates
                const generatedDate = new Date(receipt.generatedAt).toLocaleDateString('id-ID', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const estimatedDelivery = new Date(receipt.shipping.estimatedDelivery).toLocaleDateString('id-ID', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                receiptCard.innerHTML = `
                    <div class="receipt-header">
                        <div class="receipt-info">
                            <h3>Resi Pengiriman</h3>
                            <div class="receipt-number">${receipt.receiptNumber}</div>
                        </div>
                        <div class="receipt-status status-${receipt.status}">
                            ${getStatusText(receipt.status)}
                        </div>
                    </div>
                    
                    <div class="receipt-body">
                        <div class="receipt-grid">
                            <div class="info-section">
                                <h4>Informasi Pengiriman</h4>
                                <div class="info-item">
                                    <span class="info-label">Kurir</span>
                                    <span class="info-value">${receipt.courier.name} - ${receipt.courier.service}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Berat</span>
                                    <span class="info-value">${receipt.shipping.weight} kg</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Ongkos Kirim</span>
                                    <span class="info-value">Rp ${receipt.shipping.cost.toLocaleString()}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Estimasi Tiba</span>
                                    <span class="info-value">${estimatedDelivery}</span>
                                </div>
                            </div>
                            
                            <div class="info-section">
                                <h4>Informasi Penerima</h4>
                                <div class="info-item">
                                    <span class="info-label">Nama</span>
                                    <span class="info-value">${receipt.receiver.name}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Alamat</span>
                                    <span class="info-value">${receipt.receiver.address}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Kota</span>
                                    <span class="info-value">${receipt.receiver.city}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Telepon</span>
                                    <span class="info-value">${receipt.receiver.phone}</span>
                                </div>
                            </div>
                        </div>

                        <div class="tracking-timeline">
                            <h4 class="timeline-title">Status Pengiriman</h4>
                            <div class="timeline">
                                ${receipt.statusHistory.map((status, index) => `
                                    <div class="timeline-item ${index === 0 ? 'active' : ''}">
                                        <div class="timeline-content">
                                            <h5>${status.description}</h5>
                                            <div class="timeline-meta">
                                                <span>${new Date(status.timestamp).toLocaleDateString('id-ID', {
                                                    year: 'numeric',
                                                    month: 'short',
                                                    day: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                })}</span>
                                                <span>${status.location}</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="receipt-actions">
                            <a href="${receipt.courier.trackingUrl}" target="_blank" class="btn btn-outline">
                                <i class="fas fa-external-link-alt"></i> Lacak di ${receipt.courier.name}
                            </a>
                            <button class="btn" onclick="downloadReceipt('${receipt.receiptNumber}')">
                                <i class="fas fa-download"></i> Download Resi
                            </button>
                            <a href="orders.html" class="btn btn-success">
                                <i class="fas fa-shopping-bag"></i> Lihat Pesanan
                            </a>
                        </div>
                    </div>
                `;

                return receiptCard;
            }

            function getStatusText(status) {
                const statusMap = {
                    'shipment_created': 'Resi Dibuat',
                    'package_received': 'Diterima Kurir',
                    'in_transit': 'Dalam Perjalanan',
                    'out_for_delivery': 'Sedang Diantar',
                    'delivered': 'Terkirim',
                    'failed_delivery': 'Gagal Kirim'
                };
                return statusMap[status] || status;
            }
        });

        // Download receipt function
        function downloadReceipt(receiptNumber) {
            const receipt = receiptSystem.getAllReceipts().find(r => r.receiptNumber === receiptNumber);
            if (receipt) {
                const pdfData = receiptSystem.generatePDFReceipt(receipt);
                alert(`Resi ${receiptNumber} berhasil diunduh!`);
                // In real implementation, this would download actual PDF
                console.log('PDF Receipt:', pdfData);
            }
        }

        // Auto-update shipping status (simulasi)
        function simulateShippingUpdates() {
            const receipts = receiptSystem.getAllReceipts();
            const statusFlow = [
                'shipment_created',
                'package_received', 
                'in_transit',
                'out_for_delivery',
                'delivered'
            ];

            receipts.forEach(receipt => {
                if (receipt.status !== 'delivered') {
                    const currentIndex = statusFlow.indexOf(receipt.status);
                    if (currentIndex < statusFlow.length - 1) {
                        // 30% chance to update status
                        if (Math.random() > 0.7) {
                            const nextStatus = statusFlow[currentIndex + 1];
                            receiptSystem.updateShippingStatus(receipt.receiptNumber, nextStatus);
                        }
                    }
                }
            });

            // Reload receipts if on receipt page
            if (window.location.pathname.includes('receipt.html')) {
                setTimeout(() => {
                    document.getElementById('search-btn')?.click();
                }, 1000);
            }
        }

        // Run simulation every 30 seconds
        setInterval(simulateShippingUpdates, 30000);
    </script>
</body>
</html>